// ################## //
// Самописный слайдер
// ################## //
function sliderInit(el) {
  var slider = $(el),
    wrapper = slider.find(".wrapper"),
    slide = slider.find(".wrapper .slide"),
    slideAmount = slide.length,
    currentSlide = 1,
    arrow = slider.find(".slider-arrow")
  
  $(slider).find('.slider__total').text(pad(slideAmount, 2));
  
  if (wrapper.length > 1) {slideAmount /= 2}

  // Задаем ширину слайдам
  function sliderWidth() {
    wrapper.outerWidth(slideAmount*100+"%");
    slide.outerWidth(100/slideAmount+"%");
  }
  sliderWidth();

  // Функция переключения слайда
  function slideChange() {
    wrapper.css("transform", "translateX(-"+((currentSlide-1)*(100/slideAmount))+"%)");
	numberChange();
  }

  // Переключение слайдов стрелками
  function arrowNav() {
    arrow.click(function(e){
		e.preventDefault();
      if ($(this).hasClass("prev")) {
    		currentSlide -= 1;
    		if (currentSlide < 1) {currentSlide = slideAmount;}
    	} else {
    		currentSlide += 1;
    		if (currentSlide > slideAmount) {currentSlide = 1;}
    	}
      slideChange();
    });
  }
	
  // Переключение номеров слайдов
  function numberChange() {
  	$(slider).find('.slider__number').text(pad(currentSlide, 2));
  }
	
		
  // Добавление нуля к числу слайдов
  function pad(str, max) {
  	str = str.toString();
  	return str.length < max ? pad("0" + str, max) : str;
  }
	
  arrowNav();
}

// Запускаем Слайдеры
sliderInit(".page-section.lead.slider");
sliderInit(".dance-styles__slider");




// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal1 = {delay: 100, distance: '-40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal2 = {delay: 200, distance: '-40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooRevealLong = {delay: 100, distance: '-40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 2000};
var fooRevealOpacity = {delay: 100, distance: '0', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 3000};
sr.reveal('h1, .service__content, .review__content p, .page-intro p, .text-list__list li, .mission, .trainers__item, .page-menu, .news__tabs-item, .news__title time, .post__header time, .support__phone, .support__email, .support__answer', fooReveal1);
sr.reveal('.contacts__list, .contacts__fullway, .dance-category p, .news__content p, .dance__describe p, .post__content p, .trends__describe p, .dance__cost_tango, .dance__duration_tango, .tango-shedule__describe p, .contact-info__phone, .contact-info__address, .dance__cost, .dance__duration, .additionally__list-describe p, .additionally__offer p', fooReveal2);
sr.reveal('.service__bottom-img', fooRevealLong);
sr.reveal('.service__top-img img', fooRevealOpacity);


// Textillate
$(function () {
	$('.tlt').textillate({
		autoStart: false,
		in: {
			effect: 'fadeIn',
			delay: 100	
		}
	});
	$('.tlt2').textillate({
		autoStart: false,
		initialDelay: 1000,
		in: {
			effect: 'fadeIn',
			delay: 100	
		}
	});
})

$(document).ready(function(){
	$('.tlt, .tlt2').each(function(){
		$(this).data('tlt', 'true');
	});
});

$(window).scroll(function(){
	$('.tlt, .tlt2').each(function(){
		var scroll = $(window).scrollTop();
		var distance = $(this).offset().top;
		if ( scroll > (distance-$(window).height()+200) && $(this).data('tlt') == 'true') {
			$(this).textillate('start');
			$(this).data('tlt', 'false');
		}
	})
});


// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}





// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});




// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}




// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});





// Всплывающие окна
$(".fancybox").fancybox({
    fitToView   : false,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
});





// Всплывающая галерея картинок
$(".fancyimage").fancybox({
    fitToView   : true,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
});





// AJAX форма
$(document).ready(function() {
    $('form').ajaxForm(function() {
        // Успешная отправка формы
        $.fancybox([{href : '#success', fitToView   : false, autoSize    : true, openEffect  : 'fade', closeEffect : 'fade',}]);
    }); 
}); 





// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});





// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}


// Бургер
$('.page-header__burger').click(function(){
	$(this).toggleClass('active');
	$('.page-header').toggleClass('active');
});