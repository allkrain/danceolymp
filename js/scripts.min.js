// ################## //
// Самописный слайдер
// ################## //
function sliderInit(el, textfade) {
  var slider = $(el),
    wrapper = slider.find(".wrapper"),
    slide = slider.find(".wrapper .slide"),
    slideAmount = slide.length,
    currentSlide = 1,
    arrow = slider.find(".slider-arrow"),
	gallerySlide = slider.find('.slider-gallery .slide')
  
  
  $(slider).find('.slider__total').text(pad(slideAmount, 2));
  
  if (wrapper.length > 1) {slideAmount /= 2}

  // Задаем ширину слайдам
  function sliderWidth() {
    wrapper.outerWidth(slideAmount*100+"%");
    slide.outerWidth(100/slideAmount+"%");
  }
  sliderWidth();

  // Функция переключения слайда
  function slideChange() {
	  if ( textfade ) {
		  textFadeOut();
		  setTimeout(function(){
			  wrapper.css("transform", "translate3d(-"+((currentSlide-1)*(100/slideAmount))+"%,0,0)");
			  gallerySlide.removeClass('active');
		  	  gallerySlide.eq(currentSlide-1).addClass('active');
			  numberChange();
			  linkChange();
		  },250);
		  setTimeout(function() {textFadeIn();}, 1000);
	  } else {
		  wrapper.css("transform", "translate3d(-"+((currentSlide-1)*(100/slideAmount))+"%,0,0)");
		  gallerySlide.removeClass('active');
		  gallerySlide.eq(currentSlide-1).addClass('active');
		  numberChange();
		  linkChange();
	  }
  }

  // Переключение слайдов стрелками
  function arrowNav() {
    arrow.click(function(e){
		e.preventDefault();
      if ($(this).hasClass("prev")) {
    		currentSlide -= 1;
    		if (currentSlide < 1) {currentSlide = slideAmount;}
    	} else {
    		currentSlide += 1;
    		if (currentSlide > slideAmount) {currentSlide = 1;}
    	}
      slideChange();
    });
  }
	
  // Переключение номеров слайдов
  function numberChange() {
  	$(slider).find('.slider__number').text(pad(currentSlide, 2));
  }
	
		
  // Добавление нуля к числу слайдов
  function pad(str, max) {
  	str = str.toString();
  	return str.length < max ? pad("0" + str, max) : str;
  }
	
	
	// Ссылка кнопки "Подробнее" на первом слайде
	function linkChange() {
		var detailsLink = slide.eq(currentSlide-1).data('link');
		slider.find('[data-anchor]').attr('href', detailsLink);
	}
	linkChange();
	
	// Появление и исчезание текста в слайдерах
	function textFadeOut() {
		slide.find('.animated').removeClass('fadeInDown').addClass('fadeOutUp');
	}
	function textFadeIn() {
		slide.find('.animated').removeClass('fadeOutUp').addClass('fadeInDown');
	}
	
	// Переключение слайдов в галерее
	function galleryNav() {
		$('.slider-gallery .slide').click(function(e){
			e.preventDefault();
			currentSlide = $(this).index() + 1;
			slideChange();
		});
	}
	
  arrowNav();
  galleryNav();
}

// Запускаем Слайдеры
sliderInit(".page-section__maincontainer", true);
sliderInit(".dance-styles__slider", true);
sliderInit(".about__slider", false);
sliderInit(".trainers.slider", false);
sliderInit(".review_about.slider", true);
sliderInit(".news__slider", false);



// Появление текста в слайдерах при скролле
$(document).ready(function(){
	$('.animated').each(function(){
		$(this).data('animated', 'true');
		var scroll = $(window).scrollTop();
		var distance = $(this).offset().top;
		if ( scroll > (distance-$(window).height()+100) ) {
			$(this).addClass('fadeInDown');
			$(this).data('animated', 'false');
		}
	});
});

$(window).scroll(function(){
	$('.animated').each(function(){
		var scroll = $(window).scrollTop();
		var distance = $(this).offset().top;
		if ( scroll > (distance-$(window).height()+200) && $(this).data('animated') == 'true') {
			$(this).addClass('fadeInDown');
			$(this).data('animated', 'false');
		}
	})
});



// Блоки в FAQ
$('.faq__question').click(function(e){
	e.preventDefault();
	if ( $(this).parent().hasClass('closed') ) {
		$(this).parent().removeClass('closed');
		$(this).parent().addClass('opened');
		var blockheight = $(this).next().children().outerHeight();
		$(this).next().height(blockheight);
		console.log(blockheight);
	} else {
		$(this).parent().removeClass('opened');
		$(this).parent().addClass('closed');
		$(this).next().height(0);
		console.log(blockheight);
	}
});


// Переключение вкладок в Новостях
$('.news__tabs-item').click(function(e){
	e.preventDefault();
	$(this).siblings().removeClass('active');
	$(this).addClass('active');
	var newstab = $(this).data('tab');
	$('.news__tab-pane').each(function(){
		if ( $(this).attr('id') == newstab ) {
			$(this).fadeIn();
		} else {
			$(this).fadeOut();
		}
	});
});


// Выделение активного пункта главного меню
$(document).ready(function(){
	var pageurl = location.pathname.split('/');
	pageurl = pageurl[pageurl.length-1];
	$('.main-menu li a').removeClass('active');
	$('.main-menu li a[href="'+pageurl+'"]').addClass('active');
});


// Запуск видео
$('.video__promo').click(function(ev){
	$(this).addClass('active');
	$(this).find('.video__frame')[0].src += "?enablejsapi=1&autoplay=1";
    ev.preventDefault();
});


// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal1 = {delay: 100, distance: '-40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal2 = {delay: 200, distance: '-40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooRevealLong = {delay: 100, distance: '-40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 2000};
var fooRevealOpacity = {delay: 100, distance: '0', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 3000};
sr.reveal('h1, .service__content, .review__content_block p, .page-intro p, .text-list__list li, .mission, .page-menu, .news__tabs-item, .news__title time, .post__header time, .support__phone, .support__email, .support__answer', fooReveal1);
sr.reveal('.contacts__list, .contacts__fullway, .dance-category p, .news__content p, .dance__describe p, .post__content p, .trends__describe p, .dance__cost_tango, .dance__duration_tango, .tango-shedule__describe p, .contact-info__phone, .contact-info__address, .dance__cost, .dance__duration, .additionally__list-describe p, .additionally__offer p', fooReveal2);
sr.reveal('.service__bottom-img, .dance-category__img-bottom img', fooRevealLong);
sr.reveal('.service__top-img img, .dance-category__img-top img', fooRevealOpacity);


// Textillate
$(function () {
	$('.tlt').textillate({
		autoStart: false,
		in: {
			effect: 'fadeIn',
			delay: 100	
		}
	});
	$('.tlt2').textillate({
		autoStart: false,
		initialDelay: 1000,
		in: {
			effect: 'fadeIn',
			delay: 100	
		}
	});
})

$(document).ready(function(){
	$('.tlt, .tlt2').each(function(){
		$(this).data('tlt', 'true');
	});
});

$(window).scroll(function(){
	$('.tlt, .tlt2').each(function(){
		var scroll = $(window).scrollTop();
		var distance = $(this).offset().top;
		if ( scroll > (distance-$(window).height()+200) && $(this).data('tlt') == 'true') {
			$(this).textillate('start');
			$(this).data('tlt', 'false');
		}
	})
});


// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}





// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});




// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}




// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});





// Всплывающие окна
$("[data-fancybox]").fancybox({
});





// AJAX форма
$(document).ready(function() {
    $('.order-form').ajaxForm(function() {
        // Успешная отправка формы
		$('.order-form').addClass('success');
		$('.order-form').prev().addClass('success');
    }); 
}); 



// Проверка формы на правильность введенных данных
$("button").click(function(e){
	e.preventDefault();
    window.activeform = $(this).parents("form");
    checkinputs();
    checkandsubmit();
});

// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $(activeform).find("div.error").each(function(){
        formerrors += 1; 
    });
    if (formerrors === 0) {
        $(activeform).submit();
    } else {
		$(activeform).find('button').parent().addClass('error');
	}
}

// Скрипт проверки на пустое значение
function checkempty() {
    $(activeform).find('[required]').each(function(){
        if (!$(this).val()) {
            $(this).parent().addClass("error")
        } else {$(this).parent().removeClass("error")}
    });
}

// Убрать ошибку при изменении input'а
$("input").on("keyup change", function(){
   $(this).parent().removeClass("error"); 
   $(this).parent().siblings('.order-form__bottom').removeClass("error"); 
});



// Переход названия поля в активное состояние
$("input, textarea").focus(function(){
   $(this).parent().addClass('active');
});

$("input, textarea, select").on("blur change", function(){
   if ($(this).val() === "") {
       $(this).parent().removeClass('active');
   }
});




// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});





// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}


// Бургер
$('.page-header__burger').click(function(){
	$(this).toggleClass('active');
	$('.page-header').toggleClass('active');
});


// ******************* //
// *** YouTube API *** //
// ******************* //
var tag = document.createElement('script');
		tag.src = 'https://www.youtube.com/player_api';
var firstScriptTag = document.getElementsByTagName('script')[0];
		firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
var tv,
		playerDefaults = {autoplay: 0, autohide: 1, modestbranding: 0, rel: 0, showinfo: 0, controls: 0, disablekb: 1, enablejsapi: 0, iv_load_policy: 3};
var vid = [
			{'videoId': 'KvxNbi8tsrs', /*'startSeconds': 0, 'endSeconds': 112,*/ 'suggestedQuality': 'hd720'}
		],
		randomVid = Math.floor(Math.random() * vid.length),
    	currVid = randomVid;

function onYouTubePlayerAPIReady(){
  tv = new YT.Player('tv', {events: {'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange}, playerVars: playerDefaults});
}

function onPlayerReady(){
  tv.loadVideoById(vid[currVid]);
  tv.mute();
}

function onPlayerStateChange(e) {
  if (e.data === 1){
    $('#tv').addClass('active');
    $('.hi em:nth-of-type(2)').html(currVid + 1);
  } else if (e.data === 2){
    $('#tv').removeClass('active');
    if(currVid === vid.length - 1){
      currVid = 0;
    } else {
      currVid++;  
    }
//    tv.loadVideoById(vid[currVid]);
//    tv.seekTo(vid[currVid].startSeconds);
  }
    if (e.data === YT.PlayerState.ENDED) {
      tv.playVideo(); 
    }	
}
    


function vidRescale(){

  var w = $(window).width()+200,
    h = $(window).height()+200;

  if (w/h > 16/9){
    tv.setSize(w, w/16*9);
    $('.tv .screen').css({'left': '0px'});
  } else {
    tv.setSize(h/9*16, h);
    $('.tv .screen').css({'left': -($('.tv .screen').outerWidth()-w)/2});
  }
}

$(window).on('load resize', function(){
  vidRescale();
});

$('.video-bg__btn_music').on('click', function(){
  $('#tv').toggleClass('mute');
  if($('#tv').hasClass('mute')){
    tv.mute();
//	$('.sound').css("background-image", "url('img/mute.png')");
  } else {
    tv.unMute();
//	$('.sound').css("background-image", "url('img/unmute.png')");
  }
});

$('.video-bg__btn_pause').on('click', function(){
	$('#tv').toggleClass('paused');
	if($('#tv').hasClass('paused')){
		tv.playVideo();
	} else {
		tv.pauseVideo();
	}
});